{# D:\Django\MaemohP9\core\templates\core\profile.html #}
{% extends "core/base.html" %}
{% block title %}โปรไฟล์ของฉัน – MaemohMine Project{% endblock %}

{% block content %}
<div class="row justify-content-center mt-3 pt-3">
  <div class="col-md-8">
    {% comment %} {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %} {% endcomment %}

    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h3 class="card-title mb-4">แก้ไขโปรไฟล์ของฉัน</h3>
        <form method="post" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="mb-3">
            {{ profile_form.first_name.label_tag }}
            {{ profile_form.first_name }}
            {% if profile_form.first_name.errors %}<div class="text-danger">{{ profile_form.first_name.errors }}</div>{% endif %}
          </div>
          <div class="mb-3">
            {{ profile_form.last_name.label_tag }}
            {{ profile_form.last_name }}
            {% if profile_form.last_name.errors %}<div class="text-danger">{{ profile_form.last_name.errors }}</div>{% endif %}
          </div>
          <div class="mb-3">
            {{ profile_form.phone_number.label_tag }}
            {{ profile_form.phone_number }}
            {% if profile_form.phone_number.errors %}<div class="text-danger">{{ profile_form.phone_number.errors }}</div>{% endif %}
            <small class="form-text text-muted">กรอกเบอร์มือถือ เช่น 0812345678 ระบบจะทำการแปลงเป็น +66812345678 ให้อัตโนมัติ</small>
          </div>
          <div class="mb-3">
            {{ profile_form.avatar.label_tag }} <br>
            {% if request.user.profile.avatar %}
              <img src="{{ request.user.profile.avatar.url }}" class="img-thumbnail mb-2" style="max-width:150px;" alt="avatar">
            {% endif %}
            {{ profile_form.avatar }}
            {% if profile_form.avatar.errors %}<div class="text-danger">{{ profile_form.avatar.errors }}</div>{% endif %}
          </div>
          <button type="submit" name="profile_submit" class="btn btn-success">อัปเดตโปรไฟล์</button>
        </form>
      </div>
    </div>

    <div class="card shadow-sm">
      <div class="card-body">
        <h3 class="card-title mb-4">เปลี่ยนรหัสผ่าน</h3>
        <form method="post">
          {% csrf_token %}
          <div class="mb-3">
            {{ password_form.old_password.label_tag }}
            {{ password_form.old_password }}
            {% if password_form.old_password.errors %}<div class="text-danger">{{ password_form.old_password.errors }}</div>{% endif %}
          </div>
          <div class="mb-3">
            {{ password_form.new_password1.label_tag }}
            {{ password_form.new_password1 }}
            {% if password_form.new_password1.errors %}<div class="text-danger">{{ password_form.new_password1.errors }}</div>{% endif %}
          </div>
          <div class="mb-3">
            {{ password_form.new_password2.label_tag }}
            {{ password_form.new_password2 }}
            {% if password_form.new_password2.errors %}<div class="text-danger">{{ password_form.new_password2.errors }}</div>{% endif %}
          </div>
          <button type="submit" name="password_submit" class="btn btn-warning">เปลี่ยนรหัสผ่าน</button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

